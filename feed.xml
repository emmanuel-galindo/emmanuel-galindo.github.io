<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Code Bites</title>
    <description>Recording the effort...</description>
    <link>https://emmanuel-galindo.github.io/</link>
    <atom:link href="https://emmanuel-galindo.github.io/feed.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Kafka JMS Client to Confluent Cloud example</title>
      <description>&lt;p&gt;Confluent has created a JMS Client for that comes handy when working with legacy systems. Notably, it wraps a JMS 1.1 implementation and data flow goes like this:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[kafka-jms-client] &amp;lt;--- kafka protocol ---&amp;gt; [kafka broker]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is important to note that compatibility with JMS 1.1 is pretty good but not complete. Preferably, read [https://docs.confluent.io/current/clients/kafka-jms-client/].&lt;/p&gt;

&lt;p&gt;We are going to configure and run it against Confluent’s Cloud. The code can be downloaded at: [https://github.com/emmanuel-galindo/kafka-jms-client]&lt;/p&gt;

&lt;p&gt;As part of this exercise, we are going to create a producer that will create one message, and a consumer that if it is the first (from the consumer group) will download all message in the topic, if not will just use whatever offset the broker has. These clients are meant to be as much JMS compliant as possible, thus no use of specific logic, and the idea was to keep it simple.&lt;/p&gt;

&lt;p&gt;As a side note, I’ve found this exercise useful before jumping into trying to make legacy systems JMS implementation connect and interact with a topic in Confluent’s Cloud. In addition to the challenge of configuring the JMS service in the legacy system, as Kafka basically works on Layer 4 ([https://en.wikipedia.org/wiki/OSI_model]), you could expect your company’s proxy, firewall, vpn, etc to give you some trouble and executing this exercise could help you identifying what are the constraints in your network.&lt;/p&gt;

&lt;h2 id=&quot;requirements&quot;&gt;Requirements&lt;/h2&gt;

&lt;p&gt;If you haven’t already go ahead and create a free cloud account.
You’ll need to create a new topic (we are using TestTopic as name) and get some information to configure the client:
    - At API Access menu, issue an API Key and Secret to be used as username and password
    - In the Tools and client section
        - In Clients tab, at Java section, copy the properties
        - In Confluent Platform Components, at Schema Registry, create a new API Key and Secret&lt;/p&gt;

&lt;p&gt;Then, you’ll need to compile Confluent’s Kafka JMS Client following [https://docs.confluent.io/current/clients/kafka-jms-client/installation.html#appendix-1-creating-a-shaded-fat-jar]. As it is mentioned there, to avoid namespace conflicts, it adds the confluent.shaded. preffix. We’ll see this when configuring the login class.&lt;/p&gt;

&lt;p&gt;After that, go ahead and grab a jar for the JMS 1.1. I’d normally refer to Maven central, but it looks there’s some legal battle around this. I’ve found [https://repository.jboss.org/maven2/javax/jms/jms/1.1/] to have a working copy.&lt;/p&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;p&gt;Create a new working dir, or clone the repo above, and create a new lib/ folder. In there, copy the two jar files.&lt;/p&gt;

&lt;h3 id=&quot;producer&quot;&gt;Producer&lt;/h3&gt;

&lt;p&gt;Create a Producer.java file and copy below code in it. As you can see, it is a pretty standard JMS implementation. I am importing here using wildcard to make it short.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.jmx.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.naming.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Producer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JMSException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NamingException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InitialContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ConnectionFactory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectionFactory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConnectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ConnectionFactory&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Connection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createSession&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;AUTO_ACKNOWLEDGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Queue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TestTopic&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;MessageProducer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;producer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TextMessage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createTextMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; - Text message&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;producer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;consumer&quot;&gt;Consumer&lt;/h3&gt;
&lt;p&gt;In this case, a Consumer.java needs to be created with this content.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.jmx.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.naming.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Consumer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JMSException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NamingException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InitialContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ConnectionFactory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectionFactory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConnectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ConnectionFactory&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Connection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectionFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createSession&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;AUTO_ACKNOWLEDGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Queue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TestTopic&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;MessageConsumer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;consumer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createConsumer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;TextMessage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rmessage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TextMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;consumer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;receive&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Message received &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rmessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;jndiproperties&quot;&gt;jndi.properties&lt;/h3&gt;
&lt;p&gt;Create a new file jndi.properties at the same folder as the consumer and producer. Here is where the specifics for Kafka and Confluent Cloud are set:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#Kafka Cloud settings
bootstrap.servers = your_cloud_server.confluent.cloud:9092
security.protocol = SASL_SSL
#Calling the shaded version of the fat jar. Remove confluent.shaded when calling the thin jar
sasl.jaas.config = confluent.shaded.org.apache.kafka.common.security.plain.PlainLoginModule   required username=&quot;USERNAME123&quot;   password=&quot;PASSWORD123&quot;; 
ssl.endpoint.identification.algorithm = https
sasl.mechanism = PLAIN
# when there's no offset for this consumer, lets show a lot =)
auto.offset.reset = earliest
consumer.group.id = jms-client-test
queue.TestTopic = TestTopic

# Cloud Schema Registry settings
basic.auth.credentials.source = USER_INFO
schema.registry.basic.auth.user.info = USER345:PASSWORD345
schema.registry.url = https://your_cloud_registry.confluent.cloud

# JMS settings
java.naming.provider.url = tcp://your_cloud_server.confluent.cloud:9092
java.naming.factory.initial = io.confluent.kafka.jms.KafkaInitialContextFactory
client.id = jms-client-test-id
#register topics in JNDI. format: [topic|queue].[name] = [name] 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;bootstrap.servers and java.naming.provider.url has the same value&lt;/li&gt;
  &lt;li&gt;modify the USERNAME123 and PASSWORD123 with the API key and secret from Confluent Cloud&lt;/li&gt;
  &lt;li&gt;auto.offset.reset is an example of a kafka property extended to this JMS client.&lt;/li&gt;
  &lt;li&gt;consumer.group.id. If you implement this as we did above, we are letting the JMS client library know we want to use queues. In that case, the consumer group in the broker will be set to that value. As stated in the docs, if we were using topics, the lib would add a uuid to the end of the topic name and each consumer seems to end up having a sepparate consumer group. This is a very nice way to emulate what you normally experience with topics and queues in JMS.&lt;/li&gt;
  &lt;li&gt;queue.TestTopic, defines what is the kafka topic we are going to work with. In Kafka, both JMS topics and queues are implemented as Kafka topics and I believe the intention of this library is try to emulate a normal JMS behavior. If we would like to do JMS pub/sub, we would then change the implementation at the code to use JMS Topic and here we would call this property topic.TestTopic&lt;/li&gt;
  &lt;li&gt;I haven’t tested extensively the schema registry, so please free to share what you find&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;executing&quot;&gt;Executing&lt;/h2&gt;

&lt;p&gt;We are using standalone java here. In Linux you would execute this:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;javac &lt;span class=&quot;nt&quot;&gt;-cp&lt;/span&gt; lib/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:. Consumer.java
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-cp&lt;/span&gt; lib/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:. Consumer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In Windows&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;javac &lt;span class=&quot;nt&quot;&gt;-cp&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;lib/*;.&quot;&lt;/span&gt; Consumer.java
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-cp&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;lib/*;.&quot;&lt;/span&gt; Consumer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the same for the Producer.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;First execute the producer, and then the consumer. You can leave the consumer, or start a new one in another shell session. The producer will just send one message and you can ctrl+c after that.&lt;/p&gt;

&lt;p&gt;When executing the clients you should expect below output (it might take one minute or two to spin up the client and connect to the broker, feel free to add some print lines):&lt;/p&gt;

&lt;p&gt;Producer:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Message sent
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Consumer:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Message received Tue Aug 11 19:12:49 ART 2020 - Text message
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A nice test, is to shutdown the consumer, send another email and as you would expect from queues, when you spin up the consumer again you should receive the message.&lt;/p&gt;

&lt;p&gt;Another interesting one, is to modify the consumer group to a new one and it shoud download all messages.&lt;/p&gt;
</description>
      <pubDate>Tue, 11 Aug 2020 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2020/08/11/kafka-jms-client-to-confluent-cloud/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2020/08/11/kafka-jms-client-to-confluent-cloud/</guid>
    </item>
    
    <item>
      <title>Avoid adding credit card in heroku to get MongoDB</title>
      <description>&lt;h2 id=&quot;connecting-mongodb-from-heroku-free-tier&quot;&gt;Connecting MongoDB from Heroku free tier&lt;/h2&gt;

&lt;p&gt;Heroku out of the box provide a simple way to spin MongoDB instances, and automatically configures it to your running application:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;heroku addons:create mongolab
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A good tutorial on this topic is &lt;a href=&quot;https://devcenter.heroku.com/articles/mean-apps-restful-api#provision-a-mongodb-database&quot;&gt;https://devcenter.heroku.com/articles/mean-apps-restful-api#provision-a-mongodb-database&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, when running the command in the free tier, it will ask you validate a credit card in their site to verify your account:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;heroku addons:create mongolab
Creating mongolab on ⬢ radiant-lowlands-14472... &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
 ▸    Please verify your account to &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;this add-on plan &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;please enter a credit card&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; For more information, see https://devcenter.heroku.com/categories/billing Verify now
 ▸    at https://heroku.com/verify
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuring-mongodb&quot;&gt;Configuring MongoDB&lt;/h3&gt;

&lt;p&gt;Luckily, MongoDB has Atlas offering a free tier as well and we could connect to it from Heroku following these steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Register into MongoDB site&lt;/li&gt;
  &lt;li&gt;Select Shared Cluster offering for the free tier&lt;/li&gt;
  &lt;li&gt;Select the region to deploy the cluster. It might be a good idea to have in consideration the region your heroku is running to match it.&lt;/li&gt;
  &lt;li&gt;MongoDB will take several minutos to provision the cluster&lt;/li&gt;
  &lt;li&gt;Once provisioned it will look like below, and click Connect:&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/images/mongodb.png&quot; alt=&quot;mongodb.png&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;On whitelist, it asks for the IP ranges to allow connectivity from the remote client, in this case Heroku. Not sure if Heroku publish this, but you could select 0.0.0.0/0. This will enable connectivity from any source.&lt;/li&gt;
  &lt;li&gt;For the user, fill your desired username and password&lt;/li&gt;
  &lt;li&gt;Move to the next page by clicking “Choose a connection method”&lt;/li&gt;
  &lt;li&gt;Select “Connect your application”&lt;/li&gt;
  &lt;li&gt;Copy the URL and Close the dialog&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;You’ll have something like&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mongodb+srv://user:&amp;lt;password&amp;gt;@cluster0-cmmbk.mongodb.net/&amp;lt;dbname&amp;gt;?retryWrites=true&amp;amp;w=majority
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replace password, and dbname use “test”:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mongodb+srv://user:password@cluster0-cmmbk.mongodb.net/test?retryWrites=true&amp;amp;w=majority
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configuring-heroku-to-connect-to-mongodb&quot;&gt;Configuring Heroku to connect to MongoDB&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you get below output when executing an heroku command:&lt;/p&gt;
  &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ›   Error: Missing required flag:
 ›     -a, --app APP  app to run command against
 ›   See more help with --help
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;Execute the command with the app name as part of the heroku command with -a modifier. For example:&lt;/p&gt;
  &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku apps
== user@email.com Apps
radiant-lowlands-14321
$ heroku ps -a radiant-lowlands-14321  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;Now the DB is ready to receive connections. Go to your local heroku app folder and generate this config env var:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;heroku config:set &lt;span class=&quot;nv&quot;&gt;MONGODB_URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;mongodb+srv://user:password@cluster0-cmmbk.mongodb.net/test?retryWrites=true&amp;amp;w=majority&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you need a simple unit test, use this server.js:&lt;/p&gt;
&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MONGODB_URI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;connectDB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;mongoose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;useUnifiedTopology&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;useNewUrlParser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MongoDB is Connected...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Commit and push it as usual and in the logs of the app should read:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2020-06-05T00:10:30.017396+00:00 app[web.1]: Database connection ready
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
      <pubDate>Fri, 05 Jun 2020 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2020/06/05/Avoid-adding-credit-card-in-heroku-to-get-MongoDB/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2020/06/05/Avoid-adding-credit-card-in-heroku-to-get-MongoDB/</guid>
    </item>
    
    <item>
      <title>Fixing Error found in diagram Picked up _JAVA_OPTIONS -Dawt.useSystemAAFontSettings=gasp</title>
      <description>&lt;p&gt;UMLPlant VSCode extesion will fail to render the diagram code without these steps…
If you’re getting “Error found in diagram Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=gasp”&lt;/p&gt;

&lt;p&gt;You’ll get a similar warning when running “java -version”&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java &lt;span class=&quot;nt&quot;&gt;-version&lt;/span&gt;
Picked up _JAVA_OPTIONS:   &lt;span class=&quot;nt&quot;&gt;-Dawt&lt;/span&gt;.useSystemAAFontSettings&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;gasp
openjdk version &lt;span class=&quot;s2&quot;&gt;&quot;1.8.0_171&quot;&lt;/span&gt;
OpenJDK Runtime Environment &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 1.8.0_171-8u171-b11-2-b11&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
OpenJDK 64-Bit Server VM &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 25.171-b11, mixed mode&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix this, add these lines to your ~/.bashrc (or the one you use):&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;_SILENT_JAVA_OPTIONS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_JAVA_OPTIONS&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;unset &lt;/span&gt;_JAVA_OPTIONS
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'java &quot;$_SILENT_JAVA_OPTIONS&quot;'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
      <pubDate>Thu, 04 Jun 2020 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2020/06/04/fixing-error-found-in-diagram-vscode-umlplant/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2020/06/04/fixing-error-found-in-diagram-vscode-umlplant/</guid>
    </item>
    
    <item>
      <title>Proteger Router WIFI TP Link</title>
      <description>&lt;p&gt;Los ataques a los modem routers que las proveedoras de servicio colocan en muchos casos estan expuestos a ataques. Son el eslabon debil donde logran escalar a todos los dispositivos conectados (telefonos, computadoras, tablets, camaras ip, televisiones, etc).&lt;/p&gt;

&lt;p&gt;Esto siempre sucedio, pero con la popularizacion de la compra online, y el agregado de mineria de criptomonedas a las herramientas de los bot malignos, los analisis y ataques se han industrializado, donde se intenta no ser detectados y cada nodo infectado intenta expandiendirse por si mismo.&lt;/p&gt;

&lt;p&gt;https://www.darkreading.com/attacks-breaches/100000-plus-home-routers-hijacked-in-campaign-to-steal-banking-credentials/d/d-id/1332946&lt;/p&gt;

&lt;p&gt;https://www.scmagazine.com/home/security-news/ghostdns-hijacking-campaign-steps-up-attacks-on-brazilians-100k-devices-compromised/&lt;/p&gt;

&lt;p&gt;Es importante por lo tanto comenzar por establecer una contraseña segura, pero como paso adicional le sigue verificar cuan expuesto esta el router (y por lo tanto nuestros datos) hacia internet.&lt;/p&gt;

&lt;p&gt;Para lograr esto, primero es necesario conocer la IP externa que nos corresponde.  En la interfase de administracion del router, buscar la sección de status y donde diga WAN va a mencionar una IP ( que no comienza con 10, 172.16 o 192.168).&lt;/p&gt;

&lt;p&gt;Para realizar el escaneo de los puertos en Linux esto es relativamente simple con nmap. Por ejemplo, si nuestra ip fuera 45.33.32.156 (scanme.nmap.org)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-b&quot;&gt;nmap -p0- -v -A -T4 45.33.32.156
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;El resultado de puertos puede incluir alguno que esta disponible solo en la red local, por lo tanto es necesario verificar cada uno de ellos a través de un servicio online, como por ejemplo http://www.t1shopper.com/tools/port-scan/&lt;/p&gt;

&lt;p&gt;Servicios online similares pueden encontrarse con “port scan online” en google.&lt;/p&gt;

&lt;p&gt;Al confirmar los puertos disponibles, ya los pasos son muy especificos para cada router. Para el caso del TP-Link TD-W8901N se configura desde Access Management -&amp;gt; ACL, donde si esta desactivado permite trafico a la interfase de administracion del router desde la red interna como desde internet. Al activar ACL, todo acceso será bloqueado por lo que hay que agregar una regla para autorizar a la red interna “Interface LAN”.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/1539710479563.png&quot; alt=&quot;1539710479563&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Con este paso pueden haberse bloqueado varios puertos (por ejemplo el 80). Para bloquear el tráfico external hacia el resto de los puertos detectados, en este modelo de router se establecen filtros (Access Management -&amp;gt; Filter). Es importante notar la opcion para rule unmatched, con valores “Forward” o “Next”. Con Next, al fallar la regla continua con la siguiente.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/1539710779454.png&quot; alt=&quot;1539710779454&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Mayor información del router puede encontrarse en https://www.tp-link.com/ar/download/TD-W8901N.html&lt;/p&gt;
</description>
      <pubDate>Tue, 16 Oct 2018 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/es/2018/10/16/proteger-router-wifi-tp-link/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/es/2018/10/16/proteger-router-wifi-tp-link/</guid>
    </item>
    
    <item>
      <title>Acceso remoto via SSH</title>
      <description>&lt;p&gt;Una forma segura de acceder a nuestros recursos cuando no estamos en la red local es usando SSH. Esto incluye la ejecución de aplicaciones desde dentro de la red local (p2p, movie and music players, etc).&lt;/p&gt;

&lt;p&gt;Para instalar el server sshd, en linux:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;aptitude &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;openssh-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La forma segura de configurar esta comunicación es realizar una regla de port forwarding con un puerto no  comun (i.e. 46022). Luego se deberá habilitar ese puerto en el modem router hogareño.&lt;/p&gt;

&lt;p&gt;Una vez probada la comunicación usando usuario y password local, el siguiente paso es desalentar los ataques por fuerza bruta. Para ello, hay que agregar una directiva en la configuración de SSH para que sólo permita autenticarse con usuario y password en la red local. Siendo para los accesos de internet solo posible usando clave privada.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PasswordAuthentication no
ChallengeResponseAuthentication no

Match Address 10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
    PasswordAuthentication yes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notar que el bloque Match debe ser agregado al final del archivo, de otra manera todas las directivas siguientes van a ser matcheadas hasta el proximo bloque Match. Agregar en el lugar incorrecto del archivo esta instuccion puede ocasionar imposibilidad para conectarse.&lt;/p&gt;

&lt;p&gt;Para generar la clave privada, ejecutar&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh-keygen -t rsa -b 4096
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Al consultar por una clave privada, es posible dejarlo vacio pero se recomienda establecer una clave segura. Esta clave sera solicitada unicamente al momento de cargar la clave privada en el cliente.&lt;/p&gt;

&lt;p&gt;Si el resto de las opciones se dejan como estaban, en ~/.ssh/ estarán la clave privada y la publica en formato PEM y openssh respectivamente.&lt;/p&gt;

&lt;p&gt;La publica debe cargarse al archivo ~/.ssh/authorized_keys&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat id.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;La clave privada hay que instalarla en los clientes.&lt;/p&gt;

&lt;p&gt;Para el caso de putty en windows, hay que convertir la clave a Putty Private Key usando la utilidad putty-gen, e importando la clave PEM. Luego salvar como ppk y ya será posible usarla desde putty o winscp.&lt;/p&gt;
</description>
      <pubDate>Tue, 16 Oct 2018 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/es/2018/10/16/acceso-remoto-via-ssh/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/es/2018/10/16/acceso-remoto-via-ssh/</guid>
    </item>
    
    <item>
      <title>Fixing Debian UEFI boot manager with Debian Live</title>
      <description>&lt;p&gt;&lt;strong&gt;Important note:&lt;/strong&gt; If you are new to UEFI please read this 30min article to understand what’s happening: &lt;a href=&quot;https://www.happyassassin.net/2014/01/25/uefi-boot-how-does-that-actually-work-then/&quot;&gt;UEFI boot: how does that actually work, then?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The goal of this note is to fix the UEFI Boot Manager (located in the NVRAM) for a Debian installation, by using a Debian Live image to mount a broken system via chroot and then reinstall grub-efi. This will recreate the boot loader for grub2-efi in the EFI System Partition (as /boot/efi) and add an entry for it in the boot manager. 
A possible scenario to execute this workaround is when your current Linux installation dissapeared from the UEFI Boot Manager. The instructions here were executed on a Debian Jessie box.&lt;/p&gt;

&lt;p&gt;Steps summary:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Download Debian Live&lt;/li&gt;
  &lt;li&gt;Burn it to an USB drive&lt;/li&gt;
  &lt;li&gt;Fix UEFI on the USB drive&lt;/li&gt;
  &lt;li&gt;Boot Debian Live&lt;/li&gt;
  &lt;li&gt;Verify Debian Live was loaded with UEFI&lt;/li&gt;
  &lt;li&gt;Review devices location and current configuration&lt;/li&gt;
  &lt;li&gt;Mount broken system (via chroot)&lt;/li&gt;
  &lt;li&gt;Reinstall grub-efi&lt;/li&gt;
  &lt;li&gt;Verify configuration&lt;/li&gt;
  &lt;li&gt;Logout from chroot and reboot&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;download-debian-live&quot;&gt;Download Debian Live&lt;/h2&gt;
&lt;p&gt;Download it from &lt;a href=&quot;https://www.debian.org/CD/live/&quot;&gt;Debian Live&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Important:&lt;/em&gt;&lt;/strong&gt; At this point, UEFI support exists only in Debian’s installation images. The Live images do not have support for UEFI boot.&lt;/p&gt;

&lt;h2 id=&quot;burn-it-to-an-usb-drive&quot;&gt;Burn it to an USB drive&lt;/h2&gt;
&lt;p&gt;As stated in the initial recommended reading, UEFI works best with FAT32 and GPT partition table. However, Debian Live does not support it yet
so any method could be chosen. However, be sure to format the USB drive as FAT32. Recommended tools:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;For Debian Linux, &lt;a href=&quot;https://github.com/resin-io/etcher&quot;&gt;Ether&lt;/a&gt;. Note that in the instructions use the retired site pgp.mit.edu, therefore use hkp://pool.sks-keyservers.net instead.&lt;/li&gt;
  &lt;li&gt;For Windows, &lt;a href=&quot;https://rufus.akeo.ie&quot;&gt;Rufus&lt;/a&gt;. It has the advantage of clearly allow to select the Partition scheme and system type.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;fix-uefi-on-the-usb-drive&quot;&gt;Fix UEFI on the USB drive&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Dowload Shell.efi from &lt;a href=&quot;https://github.com/tianocore/edk2/tree/master/ShellBinPkg/UefiShell/X64&quot;&gt;UEFI Shell&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;On the USB drive create a EFI folder and a BOOT sub folder, then copy Shell.efi to EFI\BOOT\ and rename it to Bootx64.efi.&lt;/li&gt;
  &lt;li&gt;Using a text editor, create a file called liveboot.nsh on the root of the USB drive and paste the following into the file:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;live&lt;span class=&quot;se&quot;&gt;\v&lt;/span&gt;mlinuz &lt;span class=&quot;nv&quot;&gt;initrd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;live&lt;span class=&quot;se&quot;&gt;\i&lt;/span&gt;nitrd.img append &lt;span class=&quot;nv&quot;&gt;boot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;live components
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;boot-debian-live&quot;&gt;Boot Debian Live&lt;/h2&gt;
&lt;p&gt;Reboot the computer and hit F8 or F12 to bring the UEFI Boot Menu, and select your USB Drive. If it is shown more than one time, ensure to select the one that mentions UEFI.
After UEFI Shell loads, type liveboot.nsh and press Enter.&lt;/p&gt;

&lt;h2 id=&quot;verify-debian-live-was-loaded-with-uefi&quot;&gt;Verify Debian Live was loaded with UEFI&lt;/h2&gt;
&lt;p&gt;When Debian Live finishes loading, verify it it was loaded with UEFI with two basic methods:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Checking dmesg output you should see many lines related to EFI or UEFI.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dmesg | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; efi 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Check the EFI vars are correctly loaded&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /sys/firmware/efi | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;vars
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;review-devices-location-and-current-configuration&quot;&gt;Review devices location and current configuration&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Identify the root, boot and EFI partitions from the broken system.
Use fdisk -l to survey the current partition. EFI normally goes into /dev/sdX1. Mount one by one trying to identify which is the correct one. 
As a reference, /boot would normally look like:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /boot
total 21581
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root   157721 Oct 19 03:45 config-3.16.0-4-amd64
drwxr-xr-x 5 root root     1024 Apr  5 15:26 grub
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 16023698 Dec  5 09:50 initrd.img-3.16.0-4-amd64
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root  2679264 Oct 19 03:45 System.map-3.16.0-4-amd64
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root  3126448 Oct 19 03:41 vmlinuz-3.16.0-4-amd64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; In the case of lvm volumes, you might need to download the lvm2 package and expose the volumes before mounting:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# apt-get install lvm2&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# vgscan&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# vgchange -a -y&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# mount /dev/volumegroup/logicalvolume /mnt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Download efibootmgr and review current UEFI Boot Manager configuration&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# apt-get install efibootmgr&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# efibootmgr -v&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;mount-broken-system-via-chroot&quot;&gt;Mount broken system (via chroot)&lt;/h2&gt;
&lt;p&gt;Mounting another system via chroot is the usual procedure to recover broken system’s. Once the chroot comand is issues, Debian Live will treat the broken system’s “/” (root) as its own. Commands run in a chroot environment will affect the broken systems filesystems and not those of the Debian Live.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Mount root partition (for example an lvm)&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# mount /dev/volumegroup/logicalvolume /mnt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Mount boot partition (F.e. in drive sda)&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# mount /dev/sda2 /mnt/boot&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Mount the EFI System Partition (usually in /dev/sda1)&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# mount /dev/sda1 /mnt/boot/efi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Mount the critical virtual filesystems with the following single command:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# for i in /dev /dev/pts /proc /sys /run; do sudo mount -B $i /mnt$i; done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Chroot to your normal (and broken) system device&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# chroot /mnt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; From now on your changes will affect your normal system.
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;blockquote&gt;

  &lt;h3 id=&quot;note-for-raspberry-pi-os-previously-called-raspbian&quot;&gt;Note for Raspberry Pi OS (previously called Raspbian)&lt;/h3&gt;
  &lt;p&gt;&lt;strong&gt;&lt;em&gt;Nathan sent below comment from his experience running these notes, thanks!&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;For Raspbian LVM (Logical Volumes) are not used. There is no need to create directories for mounting a standard install. Once the partition called Linux Filesystem is mounted in /mnt, you have the /boot/efi folders, but efi is more like a placeholder where the EFI volume is mounted. Thus:&lt;/p&gt;

  &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sudo mount /dev/mmcblk0p# /mnt     (# = partition number with Linux filesystem)
# sudo mount /dev/mmcblk0p# /mnt/boot/efi     (# = partition number with EFI System)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

&lt;/blockquote&gt;

&lt;h2 id=&quot;reinstall-grub-efi&quot;&gt;Reinstall grub-efi&lt;/h2&gt;
&lt;p&gt;Download and Install grub-efi package, set the debian bootloader and create a grub config file based on your disk partitioning schema&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Install grub-efi package&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# apt-get install --reinstall grub-efi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Put the debian bootloader in /boot/efi and create an appropiate entry in the computer’s UEFI Boot Manager&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# grub-install /dev/sda&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;Re create a grub config file based on your disk partitioning schema&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# update-grub&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;verify-configuration&quot;&gt;Verify configuration&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Bootloader exists&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# file /boot/efi/EFI/debian/grubx64.efi &lt;/span&gt;
/boot/efi/EFI/debian/grubx64.efi: PE32+ executable &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;EFI application&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; x86-64 
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;stripped to external PDB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;MS Windows
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;NVRAM entry was properly created&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# efibootmgr -v | grep debian&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;logout-from-chroot-and-reboot&quot;&gt;Logout from chroot and reboot&lt;/h2&gt;
&lt;p&gt;Type ctrl+d or exit to quit the chroot session, and reboot.&lt;/p&gt;
</description>
      <pubDate>Wed, 05 Apr 2017 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2017/04/05/fixing-debian-boot-uefi-grub/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2017/04/05/fixing-debian-boot-uefi-grub/</guid>
    </item>
    
    <item>
      <title>Shrink LVM volume for Windows partition</title>
      <description>&lt;p&gt;In order to release space from an LVM volume to finally get a free physical partition requires the following steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Resize File Sytem in the LVM volume&lt;/li&gt;
  &lt;li&gt;Resize Physical Volume&lt;/li&gt;
  &lt;li&gt;Create a NTFS partition&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Also, root access is necessary&lt;/p&gt;

&lt;h2 id=&quot;resize-file-sytem-in-the-lvm-volume&quot;&gt;Resize File Sytem in the LVM volume&lt;/h2&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# lvresize --resizefs --verbose -L -30G /dev/machine_vg/root&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;resize-physical-volume&quot;&gt;Resize Physical Volume&lt;/h2&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pvresize --setphysicalvolumesize [the size of your volume - 30G] /dev/sdaX&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you get an error as:
/dev/sdaX: cannot resize to X extents as later ones are allocated.
It means there’s another volume between the free space and the end. To see it:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pvs -v --segments /dev/sdaX&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To move the free space towards the end, grab the last column from the output for the volume to move and use it in pvmove:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pvmove --alloc anywhere /dev/sdaX:xxxxx-xxxx&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;create-a-ntfs-partition&quot;&gt;Create a NTFS partition&lt;/h2&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# fdisk&lt;/span&gt;
n
c
1-n &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;partition number, probably sdaX+1]
L
87
&lt;span class=&quot;c&quot;&gt;# mkfs.ntfs /dev/sdaX&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
      <pubDate>Tue, 04 Apr 2017 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2017/04/04/shrink-lvm-for-windows-partition/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2017/04/04/shrink-lvm-for-windows-partition/</guid>
    </item>
    
    <item>
      <title>Compare dates at elements with XPath 1.0</title>
      <description>&lt;p&gt;Using xmllint limits you to XPath 1.0, but on the other hand you’ll have it available at every box around.&lt;/p&gt;

&lt;p&gt;For the following example, we want to get the cars that need service. Service data is at the element context.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;xmllint &lt;span class=&quot;nt&quot;&gt;--format&lt;/span&gt; ./example.xml
&amp;lt;?xml &lt;span class=&quot;nv&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Cars&amp;gt;
  &amp;lt;Car&amp;gt;
    &amp;lt;Model&amp;gt;Taurus&amp;lt;/Model&amp;gt;
    &amp;lt;NextService&amp;gt;2018-04-27T16:02:46+01:00&amp;lt;/NextService&amp;gt;
  &amp;lt;/Car&amp;gt;
  &amp;lt;Car&amp;gt;
    &amp;lt;Model&amp;gt;Corolla&amp;lt;/Model&amp;gt;
    &amp;lt;NextService&amp;gt;2016-11-01T16:02:46+01:00&amp;lt;/NextService&amp;gt;
  &amp;lt;/Car&amp;gt;
  &amp;lt;Car&amp;gt;
    &amp;lt;Model&amp;gt;Civic&amp;lt;/Model&amp;gt;
    &amp;lt;NextService&amp;gt;2017-04-01T16:02:46+01:00&amp;lt;/NextService&amp;gt;
  &amp;lt;/Car&amp;gt;
&amp;lt;/Cars&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The important bit below is the ./, that places the search in the context of the element of each item:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ today&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt; +&lt;span class=&quot;s2&quot;&gt;&quot;%Y%m%d&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;xmllint &lt;span class=&quot;nt&quot;&gt;--xpath&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;//Cars/Car[ number(translate(substring(./NextService,0,11), '-','')) &amp;lt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$today&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; ]&quot;&lt;/span&gt; example.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
      <pubDate>Mon, 14 Nov 2016 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/en/2016/11/14/xpath-date-compare-element/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/en/2016/11/14/xpath-date-compare-element/</guid>
    </item>
    
    <item>
      <title>Social media en el footer del Blog Jekyll</title>
      <description>&lt;h3 id=&quot;te-muestro-como-agregar-al-footer-de-tu-blog-links-a-tus-sitios-de-social-media-los-ejemplos-son-sólamente-para-github-y-linkedin-pero-usando-svg&quot;&gt;Te muestro como agregar al footer de tu blog links a tus sitios de social media. Los ejemplos son sólamente para GitHub y Linkedin… pero usando SVG!!!!&lt;/h3&gt;

&lt;h3 id=&quot;en-esta-continuación-de-github-pages-desde-linea-de-comando-vamos-a-agregar-iconos-y-links-al-footer-de-social-media&quot;&gt;En esta continuación de &lt;a href=&quot;http://emmanuel-galindo.github.io/2016/04/15/github-pages-desde-linea-de-comando.html&quot;&gt;GitHub pages desde linea de comando&lt;/a&gt; vamos a agregar iconos y links al footer de social media&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Especificar tus usuarios a _config.yml, por ejemplo los mios son:&lt;/li&gt;
&lt;/ol&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;github_username:  emmanuel-galindo
linkedin_username: emmanuelgalindo&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ol&gt;
  &lt;li&gt;Dimensionar los SVG en tu CSS customizado (css/custom.css en mi caso), y otra clase mas que uso en mi ejemplo asi no se ve tan feo&lt;/li&gt;
&lt;/ol&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;/** Icons */
.icon &amp;gt; svg {display: inline-block;width: 16px;height: 16px;vertical-align: middle;}
.icon &amp;gt; svg path { fill: #828282; }

.social-media-list {list-style: none;margin-left: 0;}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ol&gt;
  &lt;li&gt;Modificar _includes/footer.html. Por ejemplo, el que se usa en este blog actualmente es&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;https://raw.githubusercontent.com/emmanuel-galindo/emmanuel-galindo.github.io/master/_includes/footer.html&quot;&gt;https://raw.githubusercontent.com/emmanuel-galindo/emmanuel-galindo.github.io/master/_includes/footer.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Otra alternativa a los SVG, es usar la libreria de &lt;a href=&quot;http://fontawesome.io/examples/&quot;&gt;Font Awesome&lt;/a&gt;&lt;/p&gt;

</description>
      <pubDate>Sat, 16 Apr 2016 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/es/2016/04/16/social-media-en-el-footer-del-blog-jekyll/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/es/2016/04/16/social-media-en-el-footer-del-blog-jekyll/</guid>
    </item>
    
    <item>
      <title>GitHub pages desde linea de comando</title>
      <description>&lt;h3 id=&quot;en-esta-continuación-de-blog-en-github-pages-con-jekyll-parte-2-ya-tratamos-de-realizar-lo-mas-posible-desde-linea-de-comando&quot;&gt;En esta continuación de &lt;a href=&quot;http://emmanuel-galindo.github.io/2016/04/15/github-pages-jekyll-y-tinypress.html&quot;&gt;Blog en GitHub Pages con Jekyll, parte 2&lt;/a&gt; ya tratamos de realizar lo mas posible desde linea de comando&lt;/h3&gt;

&lt;h3 id=&quot;los-ejemplos-son-para-linux-debian-pero-los-pasos-son-los-mismos&quot;&gt;Los ejemplos son para Linux Debian, pero los pasos son los mismos&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Instalar git (como root):&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;# aptitude install git&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Ir a tu repositorio de la pagina en GitHub y copiar la url (aparece entre HTTPS y el botón Download ZIP)&lt;/li&gt;
  &lt;li&gt;Localmente, ir al directorio donde querés trabajar&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Clonar el repositorio (como usuario normal) usando la url del paso 2)&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ git clone https://github.com/emmanuel-galindo/emmanuel-galindo.github.io.git&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Modificar algun archivo como prueba&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Ejecutar:&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ git commit -a -m &quot;Commit&quot;; git push origin master&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Va a solicitarte usuario y password. Para evitar cargarlo en cada push, se lo puede cachear con dos comandos:&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ git config --global credential.helper cache&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ git config --global credential.helper 'cache --timeout=3600'&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;En el caso de que agregues un nuevo post desde la interface de tinypress, podes actualizar tu repo local con:&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;Quizas lo mejor sea hacer un backup…&lt;/em&gt;&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ git pull&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

</description>
      <pubDate>Sat, 16 Apr 2016 00:00:00 -0300</pubDate>
      <link>https://emmanuel-galindo.github.io/es/2016/04/16/github-pages-desde-linea-de-comando/</link>
      <guid isPermaLink="true">https://emmanuel-galindo.github.io/es/2016/04/16/github-pages-desde-linea-de-comando/</guid>
    </item>
    
  </channel>
</rss>
